# Internationalization (i18n)

This Extension supports Japanese.  
When correcting translations or adding new ones, please follow the procedure below to verify functionality.

### Prerequisites

* This assumes development work on this Extension in the following environment:
  * OS: Linux
  * Distribution: Ubuntu 22.04
  * Python 3.10.13

Also, please install the necessary packages according to the **Development Preparation** described in the [README](../../README.md).

### Editing Translation Files
Please update the translation files (.pot, .po, .mo) according to the following procedure.

1. Generate `.pot` file with the following command

    ```bash
    poetry run poe babel-extract --version=$(python3 -c "import toml; print(toml.load('pyproject.toml')['tool']['poetry']['version'])")
    ```

2. Generate `.po` file with the following command (for Japanese)

    ```bash
    poetry run poe babel-update --locale ja
    ```

3. Edit the translated strings in the `.po` file

4. Generate `.mo` file with the following command

    ```bash
    poetry run poe babel-compile
    ```

5. Place the `.mo` file in the CKAN environment
    If you are building Docker containers according to the build method described in the [README](../../README.md), the file will be placed in the development container using the above procedure.  
    When separately applying to and verifying in the CKAN environment, please place it in `ckanext/feedback/i18n/ja/LC_MESSAGES` in the ckanext-feedback package directory.

> [!WARNING] 
> About Translation Processing in JavaScript
> 
> In this Extension, when translation processing is required in JavaScript, it is implemented by embedding translated strings in Jinja2 templates.
> Although CKAN provides translation processing for JavaScript, it requires generating a dedicated translation file for JavaScript for each environment, and this approach avoids that overhead.  
> (Example)
> ```html
> <!-- html -->
> <div id="translations" hidden>
>     <span data-key="Hello, world!">{{ _('Hello, world!') }}</span>
>     <span data-key="yYou have ITEMS item(s).">{{ _('You have ITEMS item(s).') }}</span>
> </div>
> ```  
> ```javascript
> // javascript
> function getTranslatedMessage(translationKey, placeholders = {}) {
>     const translationElement = document.querySelector(`[data-key="${translationKey}"]`);
>     const rawMessage = translationElement?.textContent || translationKey;
>     let finalMessage = rawMessage;
>     for (const [placeholder, value] of Object.entries(placeholders)) {
>         finalMessage = finalMessage.replace(placeholder, value);
>     }
>     return finalMessage;
> }
> const messageHelloWorld = getTranslatedMessage('Hello, world!');
> const messageYouHaveItem = getTranslatedMessage('You have ITEMS item(s).', {ITEMS: 5});
> ```

