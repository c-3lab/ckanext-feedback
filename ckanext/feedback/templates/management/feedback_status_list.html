{% extends "page.html" %}

{% block styles %}
  {{ super() }}
  {% asset 'feedback/feedback-management-comments-css' %}
  {% asset 'feedback/feedback-tooltip-css' %}
{% endblock %}

{% block breadcrumb_content %}
  {{ super() }}
  <li class="active"><a href="{{ h.url_for('management.feedback-approval') }}">{{ _('Feedback Approval・Remove') }}</a></li>
{% endblock %}

{% block title %}{{ _('Feedback Approval・Remove') }} - CKAN{% endblock %}

{% block primary_content %}
  <article class="module">
    <div class="module-content">
      <form id="feedback-search-form" class="search-form" method="GET">
        <div class="form-group control-order-by">
          <label for="field-order-by">{{ _('Order by') }}:</label>
          <select id="field-order-by" name="sort" onchange="updateSortParameter()">
            {% set sort_items = [
              (_('Newest'), 'newest'), (_('Oldest'), 'oldest'), (_('Dataset Name Ascending'),'dataset_asc'),
              (_('Dataset Name Descending'), 'dataset_desc'), (_('Resource Name Ascending'), 'resource_asc'),
              (_('Resource Name Descending'), 'resource_desc')
            ] %}
            {% for item in sort_items + (extra_sort or []) %}
              <option value="{{ item[1] }}"{% if sort==item[1] %} selected="selected"{% endif %}>{{ item[0] }}</option>
            {% endfor %}
          </select>
        </div>
        <h2>{{ _('Feedback Approval・Remove') }}</h2>
      </form>
      <div>
        <form id="comments-form" method="post">
          <div class="right-text mb-2">
            {% set approval_action=h.url_for( "management.approve_bulk_target" ) %}
            {% set delete_action=h.url_for( "management.delete_bulk_target" ) %}
            <button class="btn btn-primary bulk-button" type="button" onclick="runBulkAction('{{ approval_action }}')">{{ _('Bulk Approval') }}</button>
            <button class="btn btn-primary bulk-button" type="button" onclick="runBulkAction('{{ delete_action }}')">{{ _('Bulk Delete') }}</button>
          </div>
          <div class="container">
            {% if feedbacks %}
              <div class="org">
                <div class="border-bottom fw-bold mb-2">
                  <div style="float:left;"><input class="checkbox-inline" type="checkbox" id="target-checkbox-all"></div>
                  <div class="row form-check-label fs-6">
                    <div class="col-2">{{ _('Dataset') }}</div>
                    <div class="col-2">{{ _('Resource') }}</div>
                    <div class="col-1">{{ _('Type') }}</div>
                    <div class="col">{{ _('Post Content') }}</div>
                    <div class="col-2">{{ _('Status') }}</div>
                  </div>
                </div>
                {% for feedback in feedbacks %}
                  <div class="target">
                    <div style="float:left;">
                      {% if feedback.feedback_type == 'リソースコメント' %}
                        <input class="checkbox-inline" type="checkbox" name="resource-comments-checkbox" id="{{ feedback.comment_id }}" value="{{ feedback.comment_id }}" data-approval="{{ feedback.is_approved }}">
                      {% elif feedback.feedback_type == '利活用申請' %}
                        <input class="checkbox-inline" type="checkbox" name="utilization-checkbox" id="{{ feedback.utilization_id }}" value="{{ feedback.utilization_id }}" data-approval="{{ feedback.is_approved }}">
                      {% elif feedback.feedback_type == '利活用コメント' %}
                        <input class="checkbox-inline" type="checkbox" name="utilization-comments-checkbox" id="{{ feedback.comment_id }}" value="{{ feedback.comment_id }}" data-approval="{{ feedback.is_approved }}">
                      {% endif %}
                    </div>
                    <div class="row form-check-label fs-6">
                      <a class="col-2 text-truncate" href="{{  h.url_for('dataset.search') }}{{ feedback.package_name }}">{{ feedback.package_title }}</a>
                      <a class="col-2 text-truncate" href="{{ h.url_for('dataset.search') }}{{ feedback.package_name }}/resource/{{ feedback.resource_id }}">{{ feedback.resource_name }}</a>
                      {% if feedback.feedback_type == 'リソースコメント' %}
                        <div class="col-1 bubble" style="margin-right: 0;">
                          <i class="fa-solid fa-comment-dots"></i>
                          <div class="description position-right">{{ _('Resource Comment') }}</div>
                        </div>
                        <a class="col text-truncate" href="{{ h.url_for('resource_comment.comment', resource_id=feedback.resource_id) }}#comment-created-{{ feedback.comment_id }}">{{ feedback.content }}</a>
                      {% elif feedback.feedback_type == '利活用申請' %}
                        <div class="col-1 bubble" style="margin-right: 0;">
                          <i class="fa-solid fa-seedling"></i>
                          <div class="description position-right">{{ _('Utilization') }}</div>
                        </div>
                        <a class="col text-truncate" href="{{ h.url_for('utilization.details', utilization_id=feedback.utilization_id) }}">{{ feedback.content }}</a>
                      {% elif feedback.feedback_type == '利活用コメント' %}
                        <div class="col-1 bubble" style="margin-right: 0;">
                          <span class="fa-stack" style="font-size: 7px;">
                            <i class="fa fa-comment fa-stack-2x" style="text-align: start;"></i>
                            <i class="fa-solid fa-seedling fa-stack-1x" style="color: #ffffff; text-align: start; margin-left: 3.3px;"></i>
                          </span>
                          <div class="description position-right">{{ _('Utilization Comment') }}</div>
                        </div>
                        <a class="col text-truncate" href="{{ h.url_for('utilization.details', utilization_id=feedback.utilization_id) }}#comment-created-{{ feedback.comment_id }}">{{ feedback.content }}</a>
                      {% endif %}
                      <div class="col-2 text-truncate">
                        {% if feedback.is_approved %}
                          {{ _('Approved') }}
                        {% else %}
                          {{ _('Waiting') }}
                        {% endif %}
                      </div>
                    </div>
                  </div>
                {% endfor %}
              </div>
            {% else %}
              <p>{{ _('There are no applications.') }}</p>
            {% endif %}
          </div>
        </form>
      </div>
    </div>
  </article>
{% endblock %}

{% block secondary_content %}
  <div class="module module-narrow module-shallow">
    <h2 class="module-heading">
      <i class="fa fa-info-circle"></i>
      {{ _('What are Feedback Approval・Remove') }}
    </h2>
    <div class="module-content">
      <p>
        {% trans %}
          You can change the approval status of resource comments to the organization, utilization requests, or comments on registered utilizations.
        {% endtrans %}
      </p>
    </div>
  </div>
  <div class="filters">
    {% for _filter in filters %}
      <section class="module module-narrow module-shallow">
        <h2 class="module-heading">
          <i class="fa fa-filter"></i>
          {{ _(_filter.type) }}
        </h2>

        <nav aria-label="{{ _filter['name'] }}">
          <ul class="list-unstyled nav nav-simple nav-facet">
          {% for filter_item in _filter.list %}
            <li class="nav-item {% if filter_item.active %} active{% endif %}">
              <a href="{{ filter_item.href }}" title="{{ filter_item.label }}">
                <span class="item-label">{{ filter_item.label }}</span>
                <span class="hidden separator"> - </span>
                <span class="item-count badge">{{ filter_item.count }}</span>
                {% if filter_item.active %}<span class="facet-close">x</span>{% endif %}
              </a>
            </li>
          {% endfor %}
          </ul>
        </nav>
      </section>
    {% endfor %}
  </div>
  <a class="close no-text hide-filters"><i class="fa fa-times-circle"></i><span class="text">close</span></a>
{% endblock %}


{%- block scripts %}
  {{ super() }}
  {% asset 'feedback/feedback-feedback-status-list-js' %}
{% endblock %}